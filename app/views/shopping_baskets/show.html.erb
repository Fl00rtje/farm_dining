<%= link_to "BACK TO INDEX", ingredients_path, class: "btn btn-farm" %>

<div class="container">
    <div class="message-box">

    <div class="message-picture">
    <% if @shopping_basket  %>
      <% @shopping_basket.orders.each do |order| %>
        <% ingredient = order.ingredient %>
        <%= cl_image_tag ingredient.photo, :width=>100, :height=>100  %>
        <% end  %>

    </div>

  <%#= link_to "BACK TO FARM", farm_path(@farm), class: "btn btn-farm" %>


        <div class='product-body'>
          <% @shopping_basket.orders.each do |order| %>
        <% ingredient = order.ingredient %>
          <p><%= link_to order.ingredient.name, ingredient_path(order.ingredient) %></p>
          <p><%= link_to order.ingredient.farm.farm_name, farm_path(order.ingredient.farm) %></p>
        </div>

        <div class="unit-info" id="lol">

          <%= simple_form_for order do |order| %>
            <%= order.input :order_quantity, collection: (1..[  ingredient.available_quantity, 100].min)%>
            <%= order.submit "update", class: "btn btn-primary" %>
          <% end %>

        </div>

        <div class="quantity">
          <p><%= order.order_quantity %> units</p>
        </div>
        <div class="unit-price">
          <p><%= humanized_money_with_symbol(ingredient.price) %>
          <%= ingredient.price_type %></p>
        </div>
        <div class="total-price">
          <p> â‚¬ <%= order.amount %></p>
        </div>


          <div id='editShoppingBasket'>
            <i class="far fa-edit"> </i>
          </div>

          <%= link_to order, method: :delete do %>

          <i class="far fa-trash-alt"> </i>
          <% end %>
          <hr>
          <% end %>
        </div>
        </div>


          <h1>Total amount:</h1>
          <%= form_tag shopping_basket_payments_path(@shopping_basket) do %>
          <article>
          <label class="amount">
          <span>Amount: <%= humanized_money_with_symbol(@shopping_basket.total_price / 100) %></span>
          </label>
          </article>


          <script src="https://checkout.stripe.com/checkout.js" class="stripe-button"
          data-key="<%= Rails.configuration.stripe[:publishable_key] %>"
          data-name="My Ingredient(s)"
          data-email="<%= current_user.email %>"
          data-description="Ingredient "
          data-amount="<%= @shopping_basket.total_price %>"
          data-currency="<%= @shopping_basket.orders.first.amount.currency %>">
          </script>

          <% end %>
          <%# else  %>
          <p>TODO  display Previous Purchases.<p/>
          <p>All purchases have been paid.</p>
          <p>Your Shopping Basket is empty<p/>
          <%#= link_to "Order New Ingredients", ingredients_path %>
          <% end  %>
        </div>
      </div>
  </div>

